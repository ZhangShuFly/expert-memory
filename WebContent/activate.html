<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>自助停车</title>
<meta name="viewport" content="initial-scale=1, maximum-scale=1">
<link rel="shortcut icon" href="./assets/40-ecology.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<link rel="stylesheet" href="./dist/css/sm.css">
<link rel="stylesheet" href="./dist/css/sm-extend.css">
<link rel="stylesheet" href="./assets/css/demos.css">

<link rel="apple-touch-icon-precomposed" href="./assets/40-ecology.png">
<script src="./assets/js/zepto.js"></script>
<script src="./assets/js/config.js"></script>


<script src="./assets/js/vue/vue.min.js"></script>
<script src="./assets/js/vue/vue-resource.min.js"></script>

<script>
	
</script>

</head>
<body>
	<!-- page集合的容器，里面放多个平行的.page，其他.page作为内联页面由路由控制展示 -->
	<div class="page-group">
		<!-- index ,第一个.page默认被展示-->
		<div class="page" id="activatePage">
			<!-- 标题栏 -->
			<header class="bar bar-nav">
				<a class="icon icon-me pull-left" id="openMenu"></a>
				<h1 class="title">自助停车</h1>
				<a class="icon icon-refresh pull-right"
					href="javascript:window.location.reload(); "></a>
			</header>

			<!-- 工具栏 -->
			<nav class="bar bar-tab">
				<a class="tab-item " href="./index.html"> <span
					class="icon icon-home"></span> <span class="tab-label">首页</span>
				</a> <a class="tab-item" href="./record.html"> <span
					class="icon icon-star"></span> <span class="tab-label">收藏</span>
				</a> <a class="tab-item " href="./myset.html"> <span
					class="icon icon-settings"></span> <span class="tab-label">设置</span>
				</a>
			</nav>

			<!-- 这里是页面内容区 -->
			<div class="content native-scroll" style="margin-top: 3rem;">
			<div class="content-block-title" style="text-align: center;font-size: 1rem; margin-bottom: 1rem;">您好，使用前，请先激活！</div>
				<div class="list-block">
					<ul>
						<li>
							<div class="item-content">
								<div class="item-media">
								</div>
								<div class="item-inner">
									<div class="item-title label">手机号</div>
									<div class="item-input">
										<input type="tel" placeholder="您的手机号" v-model="phone" >
									</div>
									<div class="item-after">
										<a href="#" class="button  button-success" id="codeBtn">验证码</a>
									</div>
								</div>
							</div>
						</li>
						<li>
							<div class="item-content">
								<div class="item-media">
								</div>
								<div class="item-inner">
									<div class="item-title label">验证码</div>
									<div class="item-input">
										<input type="number" placeholder="您收到的验证码" v-model="code">
									</div>
								</div>
							</div>
						</li>
						<li>
							<div class="item-content">
								<div class="item-media">
								</div>
								<div class="item-inner">
									<div class="item-title label">车牌号</div>
									<div class="item-input">
										<input type="text" placeholder="您的车牌号" v-model="carNo">
									</div>
								</div>
							</div>
						</li>
						<li>
							<div class="item-content">
								<div class="item-media">
								</div>
								<div class="item-inner">
									<div class="item-title label">车辆类型</div>
									<div class="item-input">
										<select v-model="carType">  
											  <option v-for="ct in allCarType" v-bind:value="ct.value">  
											    {{ ct.text }}  
											  </option>  
											</select>
									</div>
								</div>
							</div>
						</li>
					</ul>
				</div>

				<div class="content-block">
					<div class="row">
						<div class="col-50">
							<a href="#" class="button button-big button-fill button-danger back">取消</a>
						</div>
						<div class="col-50">
							<a href="#" class="button button-big button-fill button-success" v-on:click="active">提交</a>
						</div>
					</div>
				</div>

			</div>

		</div>


	</div>

	<!-- popup, panel 等放在这里 -->
	<div class="panel-overlay"></div>
	<!-- Left Panel with Reveal effect -->
	<div class="panel panel-left panel-reveal" id="menuPanel">
		<iframe name="toppage" width=100% height=100% marginwidth=0
			marginheight=0 frameborder="no" border="0" src="menu.html"></iframe>
	</div>

	<script src="./dist/js/common.js"></script>
	<script src="./dist/js/sm.js"></script>
	<script src="./dist/js/sm-extend.js"></script>
	<script src="./dist/js/sm-city-picker.js"></script>
	<script src="./assets/js/demos.js"></script>
	
	<script type="text/javascript">
	$(document).on("click", "#codeBtn", function() {
		if(11 != activateVue.phone.length ){
			$.toast("请正确输入您的手机号！");
		}else{
			activateVue.getVerificationCode();
		}
	});

	var activateVue = new Vue({
	    el:'#activatePage',
	    data: {
	        code:'',
	        phone:'',
	        carType:'SMALL_CAR',
	        allCarType: [
	                  	{ text: '小车', value: 'SMALL_CAR' },  
	        			{ text: '大车', value: 'BIG_CAR' }  
	    			  ], 
	        carNo:''
	    },
		methods: {
			getVerificationCode:function(){
				this.$http.post(getVerificationCode, {phone:activateVue.phone}).then(function(response) {
					alert(response.body.code);
					$.toast("已发送，请查收！");
	            }, function(response) {
	                // error callback
	            });
			},
			active:function(){
				if(11 != activateVue.phone.length ){
					$.toast("请正确输入您的手机号！");
				}else if(null == activateVue.code || "" == activateVue.code){
					$.toast("请输入您收到的验证码！");
				}else{
					this.$http.post(active, {phone:activateVue.phone,code:activateVue.code}).then(function(response) {
						var resu = response.body;
						if(resu.ok == true){
							activateVue.saveCar()
						}else{
		                	$.toast(resu.msg);
		                }
						
		            }, function(response) {
		                // error callback
		            });
				}
			},
			saveCar:function(){
				this.$http.post(saveCar, {phone:activateVue.phone,carNo:activateVue.carNo,carType:activateVue.carType}).then(function(response) {
					var resu = response.body;
					if(resu.ok == true){
						$.toast("操作成功");
	                	setCookie("user",activateVue.phone);
	                	window.location.href = "index.html";
	                	return true;
					}else{
	                	$.toast(resu.msg);
	                	return false;
	                }
					
	            }, function(response) {
	            	 return false;
	            });
			}
		}
	});

	</script>
	
</body>
</html>